---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
}

const { title, description = '一个简约的个人博客' } = Astro.props;
---

<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <script is:inline>
      const storageKey = 'theme';
      const root = document.documentElement;
      let saved = null;
      try {
        saved = localStorage.getItem(storageKey);
      } catch {}
      const prefersDark = window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)').matches : false;
      root.dataset.theme = saved || (prefersDark ? 'dark' : 'light');

      const updateToggle = (toggle, value) => {
        if (!toggle) return;
        toggle.setAttribute('aria-label', value === 'dark' ? '切换到浅色模式' : '切换到深色模式');
      };

      window.addEventListener('DOMContentLoaded', () => {
        const toggle = document.querySelector('[data-theme-toggle]');
        if (!toggle) return;
        updateToggle(toggle, root.dataset.theme);
        toggle.addEventListener('click', () => {
          const next = root.dataset.theme === 'dark' ? 'light' : 'dark';
          root.dataset.theme = next;
          try {
            localStorage.setItem(storageKey, next);
          } catch {}
          updateToggle(toggle, next);
        });
      });
    </script>
    <title>{title}</title>
  </head>
  <body class="min-h-screen bg-[color:var(--paper)] text-[color:var(--ink)] antialiased flex flex-col">
    <!-- 导航栏 -->
    <header class="sticky top-0 z-50 border-b border-[color:var(--line)] bg-[color:var(--surface-strong)] backdrop-blur-md">
      <nav class="mx-auto flex max-w-6xl items-center justify-between px-6 py-4">
        <a href="/" class="font-display text-xl font-semibold tracking-tight text-[color:var(--ink)] hover:text-primary-700 transition-colors">
          我的博客
        </a>
        <div class="flex items-center gap-5">
          <a href="/" class="text-sm text-[color:var(--muted)] hover:text-[color:var(--ink)] transition-colors">
            首页
          </a>
          <a href="/admin" class="text-sm text-[color:var(--muted)] hover:text-[color:var(--ink)] transition-colors">
            管理
          </a>
          <button
            type="button"
            data-theme-toggle
            aria-label="切换主题"
            class="inline-flex h-9 w-9 items-center justify-center rounded-full border border-[color:var(--line)] bg-[color:var(--surface)] text-[color:var(--muted)] transition hover:border-primary-300 hover:text-primary-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500/40"
          >
            <span class="theme-icon theme-icon-moon" aria-hidden="true">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z" />
              </svg>
            </span>
            <span class="theme-icon theme-icon-sun" aria-hidden="true">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.36 6.36-1.42-1.42M8.06 8.06 6.64 6.64m11.31-1.42-1.42 1.42M8.06 15.94l-1.42 1.42M12 8a4 4 0 100 8 4 4 0 000-8z" />
              </svg>
            </span>
          </button>
        </div>
      </nav>
    </header>

    <!-- 主内容区 -->
    <main class="mx-auto max-w-6xl w-full px-6 py-12 sm:py-16 flex-1">
      <slot />
    </main>

    <!-- 页脚 -->
    <footer class="border-t border-[color:var(--line)] mt-auto">
      <div class="mx-auto max-w-6xl px-6 py-8">
        <p class="text-center text-sm text-[color:var(--muted)]">
          &copy; {new Date().getFullYear()} 我的博客. 使用 Astro 构建.
        </p>
      </div>
    </footer>
  </body>
</html>

<style is:global>
  * {
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
  }
</style>
